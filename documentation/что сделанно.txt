–ü–æ–¥—ã—Ç–æ–∂–∏–º, —á—Ç–æ –º—ã —Å–µ–≥–æ–¥–Ω—è —Å–¥–µ–ª–∞–ª–∏ üëá

üîß Backend / –ú–æ–¥–µ–ª–∏

–ü—Ä–∏–≤–µ–ª–∏ models.py –∫ —Ä–∞–±–æ—á–µ–º—É –≤–∏–¥—É:

–£–±—Ä–∞–ª–∏ –¥—É–±–ª–∏ –∫–ª–∞—Å—Å–æ–≤ Teacher, Subject, Booking.

–ù–∞—Å—Ç—Ä–æ–∏–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ relationship –º–µ–∂–¥—É:

Teacher ‚Üî TimeSlot

Subject ‚Üî TimeSlot

TimeSlot ‚Üî Booking

–¢–µ–ø–µ—Ä—å SQLAlchemy –∏ sqladmin –ø–æ–Ω–∏–º–∞—é—Ç —Å–≤—è–∑–∏, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ *_id.

üñ•Ô∏è Admin-–ø–∞–Ω–µ–ª—å

–ò—Å–ø—Ä–∞–≤–∏–ª–∏ admin.py:

–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è (teacher, subject), –∞ –Ω–µ teacher_id/subject_id.

–ù–∞—Å—Ç—Ä–æ–∏–ª–∏ form_ajax_refs –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ model).

–î–æ–±–∞–≤–∏–ª–∏ init_admin(app) –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏.

–ü–æ—á–∏–Ω–∏–ª–∏ –±–∞–≥ TypeError: QueryAjaxModelLoader.__init__() got multiple values for argument 'model'.

üê≥ Docker / –ó–∞–ø—É—Å–∫

–õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏ –¥–≤–µ –∫–ª—é—á–µ–≤—ã–µ –æ—à–∏–±–∫–∏:

ValueError: <TimeSlot>.teacher_id is not a relation ‚Üí —Ä–µ—à–µ–Ω–æ —á–µ—Ä–µ–∑ relationships.

Table 'teachers' is already defined ‚Üí —Ä–µ—à–µ–Ω–æ —É–¥–∞–ª–µ–Ω–∏–µ–º –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –∫–ª–∞—Å—Å–æ–≤.

–ü–æ—Å–ª–µ –ø—Ä–∞–≤–æ–∫ —Å–µ—Ä–≤–∏—Å –ø–µ—Ä–µ—Å—Ç–∞–ª –ø–∞–¥–∞—Ç—å –Ω–∞ —ç—Ç–∏—Ö –æ—à–∏–±–∫–∞—Ö.

üìë –¢–ó

–£—Ç–æ—á–Ω–∏–ª–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏–∑ –¢–ó:

–î–æ–±–∞–≤–∏–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É —Å—Ç–∞—Ç—É—Å–∞ tentative (–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Å–ª–æ—Ç—ã).

–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–ª–æ—Ç–æ–≤ —É—Ç—Ä–æ–º (MORNING_CONFIRM_CRON).

–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ —Ä–æ–ª–∏.

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –∞–¥–º–∏–Ω–∫—É: —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º —Å–ª–æ—Ç–æ–≤.

API

‚úÖ JWT-–ª–æ–≥–∏–Ω//auth/me//auth/logout (cookie httpOnly).

‚úÖ GET /bookings —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ + X-Total-Count + RBAC(admin).

‚úÖ PATCH /bookings/{id} (—Å–º–µ–Ω–∞ —Å—Ç–∞—Ç—É—Å–∞), DELETE /bookings/{id}.

‚úÖ GET /bookings/export.csv (UTF-8 + BOM, ;).

‚úÖ GET /reports/teacher-load (—É—Ä–æ–≤–µ–Ω—å —É—á–∏—Ç–µ–ª—è –∑–∞ –ø–µ—Ä–∏–æ–¥).

‚úÖ GET /users (+–ø–æ–∏—Å–∫), POST /users, PATCH /users/{id}, DELETE /users/{id}.

‚úÖ GET /teachers, POST /teachers, DELETE /teachers/{id}.

‚úÖ –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–º X-Total-Count.

‚úÖ CORS —Å expose_headers=["X-Total-Count"].

‚úÖ RBAC-—Ö–µ–ª–ø–µ—Ä require_role(...) –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞ –∞–¥–º–∏–Ω—Å–∫–∏—Ö —Ä—É—á–∫–∞—Ö.

‚úÖ –§–∏–∫—Å—ã —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —É–¥–∞–ª–µ–Ω–∏—è (–±–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —É—á—ë—Ç FK/–∫–∞—Å–∫–∞–¥–æ–≤).

–ß—Ç–æ  —Å–µ–≥–æ–¥–Ω—è —Å–¥–µ–ª–∞–ª–∏

–ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö

–í TimeSlot –¥–æ–±–∞–≤–∏–ª–∏ –ø–æ–ª—è lesson_type (–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ/–≥—Ä—É–ø–ø–æ–≤–æ–µ) –∏ mode (online/offline).

–î–æ–±–∞–≤–∏–ª–∏ check-constraint: individual ‚Üí capacity=1, group ‚Üí capacity>=2.

Alembic –º–∏–≥—Ä–∞—Ü–∏–∏

–°–æ–∑–¥–∞–ª–∏ —Ä–µ–≤–∏–∑–∏—é add_lesson_type, –ø—Ä–æ–≥–Ω–∞–ª–∏ upgrade head, —É—Å—Ç—Ä–∞–Ω–∏–ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å –¥–≤—É–º—è head-–∞–º–∏.

–ë–∞–∑–∞ —Ç–µ–ø–µ—Ä—å –ø–æ–Ω–∏–º–∞–µ—Ç –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –∑–∞–Ω—è—Ç–∏–π –∏ –≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å.

API

/teachers/{id}/slots –∏ /slots —Ç–µ–ø–µ—Ä—å —É–º–µ—é—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ mode –∏ lesson_type.

–í —Å—Ö–µ–º–∞—Ö (SlotOut, CreateTeacherSlotsIn, PatchSlotIn) –ø–æ—è–≤–∏–ª–∏—Å—å –ø–æ–ª—è lesson_type.

PATCH/POST –¥–ª—è —Å–ª–æ—Ç–æ–≤ —É—á–∏—Ç—ã–≤–∞—é—Ç —ç—Ç–∏ –Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.

main.py

–û–±–Ω–æ–≤–ª—ë–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é: —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –ª–æ–≥–∏–Ω–∞, —Å–ª–æ—Ç–æ–≤, –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π, –æ—Ç—á—ë—Ç–æ–≤ —É–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç lesson_type/mode.

–î–æ–±–∞–≤–ª–µ–Ω –≤–æ–∑–≤—Ä–∞—Ç free_spots (capacity ‚Äì –±—Ä–æ–Ω–∏).

–í—Å—ë –≥–æ—Ç–æ–≤–æ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Ñ—Ä–æ–Ω—Ç–∞.
–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –¥–ª—è web-–º–æ—Ä–¥—ã

–°–µ–π—á–∞—Å API –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –≤—Å—ë –±–∞–∑–æ–≤–æ–µ:

CRUD –¥–ª—è —Å–ª–æ—Ç–æ–≤ (—Å mode/lesson_type).

CRUD –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π + —ç–∫—Å–ø–æ—Ä—Ç CSV.

CRUD –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π/—É—á–∏—Ç–µ–ª–µ–π.

–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è JWT (cookie-friendly, –¥–ª—è —Ñ—Ä–æ–Ω—Ç–∞).

–ù–∞—á–∞–ª–æ –¥–ª—è –æ—Ç—á—ë—Ç–æ–≤ (/reports/teacher-load).

–¢–æ –µ—Å—Ç—å –ø–æ —Å–ø–∏—Å–∫—É –∏–∑ –¢–ó –∏ –ø–ª–∞–Ω–∞ web-ui (–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å web ui.txt) —É –Ω–∞—Å:
‚úî auth/login, auth/me
‚úî subjects
‚úî teachers/{id}/slots (GET/POST)
‚úî slots (GET/PATCH/DELETE)
‚úî bookings (GET/POST/PATCH/DELETE, export.csv)
‚úî –æ—Ç—á—ë—Ç teacher-load

–û—Å—Ç–∞–ª–æ—Å—å –º–µ–ª–æ—á–∏:

–¥–æ–±–∞–≤–∏—Ç—å –æ—Ç—á—ë—Ç subject-load,

iCal —ç–∫—Å–ø–æ—Ä—Ç (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω),

—Ñ—Ä–æ–Ω—Ç (Next.js + FullCalendar) –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫ API.